<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Tubes 3 Grafkom</title>
        <script src="main.js" type="module"></script>
        <link rel="stylesheet" href="style.css" />
    </head>
    <body>
        <div class="row">
            <div class="canvas">
                <canvas id="gl-canvas"></canvas>
            </div>
            <div class="load-save-container">
                <table>
                    <tr>
                        <td>
                            <h3>Save/Load File</h3>
                            <button id="save">Save Model</button>
                            <div class="load-container">
                                <input type="file" name="load" id="load" />
                            </div>
                        </td>
                    </tr>
                    <br />
                    <tr>
                        <td>
                            <br />
                            <h3>Help Menu</h3>
                            <button id="help" onclick="window.open('help.html','_blank')">Help Me!</button>
                        </td>
                    </tr>
                </table>
            </div>
            <div class="panel">
                <div>
                    <h3>Object Control Panel</h3>
                    <table>
                        <tr>
                            <td><label>Shading Mode</label></td>
                        </tr>
                        <tr>
                            <td> 
                                <select name="shadingMode" id="shadingMode">
                                    <option id="ButtonDefault" value="defaultview">Default View</option>
                                    <option id="ButtonShading" value="shadingmode">Shading Mode</option>
                                </select>
                            </td>
                        </tr>
                        <tr>
                            <td><label>Texture Mapping Mode</label></td>
                        </tr>
                        <tr>
                            <td>
                                <select name="textureMappingMode" id="textureMappingMode">
                                    <option id="ButtonTexture-1" value="image">Image</option>
                                    <option id="ButtonTexture-2" value="environment">Environment</option>
                                    <option id="ButtonTexture-3" value="bump">Bump</option>
                                </select>
                            </td>
                        </tr>
                        <tr>
                            <p>Animation Control</p>
                            <button id="ButtonAnimateOn">Animate Model ON</button>
                            <button id="ButtonAnimateOff">Animate Model OFF</button>
                        </tr>
                        <tr> 
                            <p>Auto Rotation Control</p>
                            <select name="ButtonRotate" id="ButtonRotate">
                                <option id="ButtonT" value="rotateOff">Rotate Off</option>
                                <option id="ButtonX" value="rotateX">Rotate X</option>
                                <option id="ButtonY" value="rotateY">Rotate Y</option>
                                <option id="ButtonZ" value="rotateZ">Rotate Z</option>
                            </select>
                        </tr>
                        <tr>
                            <td><label>Model View Control</label></td>
                        </tr>
                        <tr>
                            <td>
                                <label>Translasi X</label>
                                <input type="range" class="slider" step="0.01" min="-80" max="80" id="PositionX" value="0" />
                                <label id="xTranslasiText"></label>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <label>Translasi Y</label>
                                <input type="range" class="slider" step="0.01" min="-80" max="80" id="PositionY" value="0" />
                                <label id="yTranslasiText"></label>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <label>Translasi Z</label>
                                <input type="range" class="slider" step="0.01" min="-80" max="80" id="PositionZ" value="0" />
                                <label id="zTranslasiText"></label>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <label>Rotasi X</label>
                                <input type="range" class="slider" step="0.01" min="0" max="360" value="0" id="AngleX" />
                                <label id="xRotasiText"></label>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <label>Rotasi Y</label>
                                <input type="range" class="slider" step="0.01" min="0" max="360" value="0" id="AngleY"  />
                                <label id="yRotasiText"></label>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <label>Rotasi Z</label>
                                <input type="range" class="slider" step="0.01" min="0" max="360" value="0" id="AngleZ" />
                                <label id="zRotasiText"></label>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <label>Scale X</label>
                                <input type="range" class="slider" step="0.01" min="0" max="10"  id="ScaleX" value="500" />
                                <label id="xScaleText"></label>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <label>Scale Y</label>
                                <input type="range" class="slider" step="0.01" min="0" max="10" id="ScaleY" value="500" />
                                <label id="yScaleText"></label>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <label>Scale Z</label>
                                <input type="range" class="slider" step="0.01" min="0" max="10" id="ScaleZ" value="500" />
                                <label id="zScaleText"></label>
                            </td>
                        </tr>
                    </table>
                </div>
            </div>
            <div class="panel2">
                <table>
                    <tr>
                        <td><label>Model Direct Control</label></td>
                    </tr>
                    <tr>
                        <td>
                            <label>Part 1</label>
                            <input type="range" class="slider" step="0.01" min="0" max="1" id="part-1" value="0" />
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <label>Part 2</label>
                            <input type="range" class="slider" step="0.01" min="0" max="1" id="part-2" value="0" />
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <label>Part 3</label>
                            <input type="range" class="slider" step="0.01" min="0" max="1" id="part-3" value="0" />
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <label>Part 4</label>
                            <input type="range" class="slider" step="0.01" min="0" max="1" id="part-4" value="0" />
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <label>Part 5</label>
                            <input type="range" class="slider" step="0.01" min="0" max="1" id="part-5" value="0" />
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <label>Part 6</label>
                            <input type="range" class="slider" step="0.01" min="0" max="1" id="part-6" value="0" />
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <label>Part 7</label>
                            <input type="range" class="slider" step="0.01" min="0" max="1" id="part-7" value="0" />
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <label>Part 8</label>
                            <input type="range" class="slider" step="0.01" min="0" max="1" id="part-8" value="0" />
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <label>Part 9</label>
                            <input type="range" class="slider" step="0.01" min="0" max="1" id="part-9" value="0" />
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <label>Part 10</label>
                            <input type="range" class="slider" step="0.01" min="0" max="1" id="part-10" value="0" />
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <label>Part 11</label>
                            <input type="range" class="slider" step="0.01" min="0" max="1" id="part-11" value="0" />
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <label>Part 12</label>
                            <input type="range" class="slider" step="0.01" min="0" max="1" id="part-12" value="0" />
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <label>Part 13</label>
                            <input type="range" class="slider" step="0.01" min="0" max="1" id="part-13" value="0" />
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <label>Part 14</label>
                            <input type="range" class="slider" step="0.01" min="0" max="1" id="part-14" value="0" />
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <label>Part 15</label>
                            <input type="range" class="slider" step="0.01" min="0" max="1" id="part-15" value="0" />
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <label>Part 16</label>
                            <input type="range" class="slider" step="0.01" min="0" max="1" id="part-16" value="0" />
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <label>Part 17</label>
                            <input type="range" class="slider" step="0.01" min="0" max="1" id="part-17" value="0" />
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <label>Part 18</label>
                            <input type="range" class="slider" step="0.01" min="0" max="1" id="part-18" value="0" />
                        </td>
                    </tr>
                </table>
            </div>
            <div class="camera">
                <table>
                    <tr>
                        <h3>Camera Setting</h3>
                    </tr>
                    <tr>
                        <td>
                            <label id="Center-X-info">Center X</label>
                        <input id="Center-X" type="range" class="slider" step="0.01" min="0" max="10" id="cameraZoom"/>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <label id="Center-Y-info">Center Y</label>
                        <input id="Center-Y" type="range" class="slider" step="0.01" min="0" max="10" id="cameraZoom"/>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <label id="Center-Z-info">Center Z</label>
                        <input id="Center-Z" type="range" class="slider" step="0.01" min="0" max="10" id="cameraZoom"/>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <label id="Up-X-info">Up X</label>
                        <input id="Up-X" type="range" class="slider" step="0.01" min="0" max="10" id="cameraZoom"/>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <label id="Up-Y-info">Up Y</label>
                        <input id="Up-Y" type="range" class="slider" step="0.01" min="0" max="10" id="cameraZoom"/>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <label id="Up-Z-info">Up Z</label>
                        <input id="Up-Z" type="range" class="slider" step="0.01" min="0" max="10" id="cameraZoom"/>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <label id="Eye-X-info">Eye X</label>
                        <input id="Eye-X" type="range" class="slider" step="0.01" min="0" max="10" id="cameraZoom"/>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <label id="Eye-Y-info">Eye Y</label>
                        <input id="Eye-Y" type="range" class="slider" step="0.01" min="0" max="10" id="cameraZoom"/>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <label id="Eye-Z-info">Eye Z</label>
                        <input id="Eye-Z" type="range" class="slider" step="0.01" min="0" max="10" id="cameraZoom"/>
                        </td>
                    </tr>
                </table>
            </div>

        </div>

        <script id="vertex-shader-2d" type="x-shader/x-fragment">
            attribute vec4 aVPos;
attribute vec3 aVNormal;
attribute vec3 aVTangent;
attribute vec3 aVBitangent;
attribute vec2 aTexCoord;

uniform mat4 uNormalM;
uniform mat4 uModelViewM;
uniform mat4 uProjM;

varying highp vec2 vTextureCoord;
varying highp vec3 vLighting;
varying vec3 vWorldPosition;
varying vec3 vWorldNormal;
uniform int texType1;

varying vec3 ts_light_pos;
varying vec3 ts_view_pos;
varying vec3 ts_frag_pos;

mat3 transpose(in mat3 inMatrix)
{
    vec3 i0 = inMatrix[0];
    vec3 i1 = inMatrix[1];
    vec3 i2 = inMatrix[2];

    mat3 outMatrix = mat3(
        vec3(i0.x, i1.x, i2.x),
        vec3(i0.y, i1.y, i2.y),
        vec3(i0.z, i1.z, i2.z)
    );

    return outMatrix;
}

void main(void) {
    if (texType1 == 0){
        gl_Position = uProjM * uModelViewM * aVPos;
        vTextureCoord = aTexCoord;
        // Apply lighting effect
        highp vec3 ambientLight = vec3(0.3, 0.3, 0.3);
        highp vec3 directionalLightColor = vec3(1, 1, 1);
        highp vec3 directionalVector = normalize(vec3(0.85, 0.8, 0.75));

        highp vec4 transformedNormal = uNormalM * vec4(aVNormal, 1.0);

        highp float directional = max(dot(transformedNormal.xyz, directionalVector), 0.0);
        vLighting = ambientLight + (directionalLightColor * directional);
    } else if (texType1 == 1){
        gl_Position = uProjM * uModelViewM * aVPos;
        
        // Send the view position to the fragment shader
        vWorldPosition = (uModelViewM * aVPos).xyz;
        
        // Orient the normals and pass to the fragment shader
        vWorldNormal = mat3(uModelViewM) * aVNormal;
    } else {
        gl_Position = uProjM * uModelViewM * aVPos;
        ts_frag_pos = vec3(uModelViewM * aVPos);
        
        vec3 t = normalize(mat3(uNormalM) * aVTangent);
        vec3 b = normalize(mat3(uNormalM) * aVBitangent);
        vec3 n = normalize(mat3(uNormalM) * aVNormal);
        mat3 tbn = transpose(mat3(t, b, n));

        vec3 light_pos = vec3(1, 2, 0);
        ts_light_pos = tbn * light_pos;
        ts_view_pos = tbn * vec3(0, 0, 0);
        ts_frag_pos = tbn * ts_frag_pos;

        vTextureCoord = aTexCoord;
    }
}
        </script>
        <script id="fragment-shader-2d" type="x-shader/x-fragment">
            precision highp float;
            // All variables for Environment Mapping
            // Passed in from the vertex shader.
            varying vec3 vWorldPosition;
            varying vec3 vWorldNormal;
            
            // The texture
            uniform samplerCube uTex;
            
            // The position of the camera
            uniform vec3 uWorldCameraPos;
            uniform int texType2;
            
            // All variables for Texture Mapping
            varying highp vec2 vTextureCoord;
            varying highp vec3 vLighting;
            uniform sampler2D uSampler2D;
            uniform bool uShadingB;
            
            // All variables for Bump Mapping
            varying vec3 ts_light_pos;
            varying vec3 ts_view_pos;
            varying vec3 ts_frag_pos;
            
            void main(void) {
                if (texType2 == 0){
                    highp vec4 texelColor = texture2D(uSampler2D, vTextureCoord);
                    if (uShadingB) {
                        gl_FragColor = vec4(texelColor.rgb * vLighting, texelColor.a);
                    } else {
                        gl_FragColor = texelColor;
                    }
                } else if (texType2 == 1) {
                    vec3 worldNormal = normalize(vWorldNormal);
                    vec3 eyeToSurfaceDir = normalize(vWorldPosition - uWorldCameraPos);
                    vec3 direction = reflect(eyeToSurfaceDir, worldNormal);
                    gl_FragColor = textureCube(uTex, direction);
                } else {
                    vec3 light_dir = normalize(ts_light_pos - ts_frag_pos);
                    vec3 view_dir = normalize(ts_view_pos - ts_frag_pos);
                    vec3 albedo = texture2D(uSampler2D, vTextureCoord).rgb;
                    vec3 ambient = 0.3 * albedo;
                    vec3 norm = normalize(texture2D(uSampler2D, vTextureCoord).rgb * 2.0 - 1.0);
                    float diffuse = max(dot(light_dir, norm), 0.0);
                    gl_FragColor = vec4(diffuse * albedo + ambient, 1.0);
                }
            }
        </script>
        
    </body>
</html>
